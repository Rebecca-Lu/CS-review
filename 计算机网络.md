# 计算机网络体系结构

## 1.1概述

### 概念

关键词：互联的、自治的

广义：实现远程信息处理的系统、能进一步达到资源共享的系统

资源共享：以能够相互 **共享资源** 的方式 **互联** 起来的 **自治** 计算机系统的集合

用户透明

### 组成

组成：**硬件**（主机-端系统、通信链路-双绞线/光纤、交换设备-路由器/交换机、通信处理器-网卡）、**软件**（操作系统、邮件、FTP）、**协议**-计算机网络的核心

工作方式：**边缘部分**（主机-通信、资源共享）& **核心部分**（大量的网络和连接这些网络的路由器组成 -- 为边缘部分提供连通性和交换服务）

功能：**通信子网**（各种传输介质、通信设备、响应的网络协议 == 数据传输、交换、控制和存储） & **资源子网** （实现资源共享功能的设备、软件 == 共享其它计算机上的硬件资源、软件资源、数据资源）

###功能

数据通信	资源共享	分布式处理	提高可靠性	负载均衡

###分类

- 分布范围（若中央处理器之间的距离非常近1m，一般称为多处理器系统，而不是计算机网络。）
  - 广域网WAN（Internet核心）	<u>提供长距离通信</u> 	交换机连接广域网的各节点（高速链路）	<u>交换技术</u>
  - 城域网MAN     <u>以太网技术</u>
  - 局域网LAN      微机/工作站     <u>广播技术</u>
  - 个人区域网PAN
- 传输技术
  - 广播式网络	all共享一个公共通信信道，one广播，other收听，接收的计算机 <u>通过检查目的的地址来决定是否接收该分组</u>
    - 例子：局域网	广域网中的*无线、卫星通信网络*
  - 点对点网络    每条物理线路连接一对计算机，如果通信的两台主机之间没有直接连接的线路，那么它们之间的分组传输就要通过**中间节点** <u>接收、存储、转发，直至目的结点</u>
- 拓扑结构（网中结点【路由器，主机】与通信线路【网线】之间的几何关系 *通信子网* ）
  - 星形网络   <u>便于集中控制和管理</u> **N个结点，N-1条线路** 中央设备（交换机/路由器）
  - 总线形网络 单根传输线把计算机连接起来。
  - 环形网络   令牌环局域网，环中信号是 <u>单向传输</u>
  - 网状行网络   广域网
- 交换技术
  - 电路交换网络   <u>一条专用的通路用于传送数据</u> 建立连接->传输数据->断开连接 
    - ad：数据直接传输、时延小
    - dis：线路利用率低、不便于差错检验
  - 报文交换网络（存储-转发）   用户数据+源地址、目的地址、校验码 <u>报文传送，全部存储后再转发</u> 
    - ad：充分利用线路容量，实现不同链路之间不同数据率的转换 差错检验
    - dis：增大了资源开销 需要额外的控制机制确保多个报文的顺序不乱序 缓冲区难以控制（因为不知道大小
  - 分组交换网络（包交换）  将数据分成较短的固定长度的数据块，每个数据块都加上目的地址、源地址等信息 <u>存储转发</
    - ad：同报文交换 plus 缓冲易于管理、包的平均时延更小、易于标准化、适合应用

### 性能指标

- 带宽：网络的通信线路所能**传送数据**的能力   比特/秒（b/s）

- 时延：数据从一端传送到另一端所需要的总时间

  - 传输时延（发送时延）：从发送分组的第一个比特算起，到该分组的最后一个比特发送完毕所需的时间

    ​    														传输时延=分组长度/信道宽度（发送速率）

  - 传播时延：一个比特从链路的一端传播到另一端所需的时间

     															传播时延=信道长度/电磁波在信道上的传播速率

  - 处理时延

  - 排队时延

    **高速链路，提高的仅是<u>数据发送速率</u>而非比特在链路上的传播速率** 

- 时延带宽积：发送端连续发送数据且发送的<u>第一个比特</u>即将到达终点时，发送端已经发出的比特数 （管道可以容纳的比特数量）

     																 时延带宽积=传播时延*信道带宽

- 往返时延

- 吞吐量   受网络带宽或网络额定速率的限制

- 速率  （最高速度率称为贷款



## 1.2结构与参考模型

### 分层结构

目的：降低协议设计和调试过程的复杂性，方便对网络进行研究、实现和维护，促进标准化工作

体系结构：计算机网络的各层及其协议的集合

实体：任何可发送或接收信息的硬件或软件进程，通常是一个特定的软件模块。

对等层：不同机器上的同一层

报文PDU=数据部分SDU+控制信息部分PCI

- 服务数据单元SDU：为完成用户所要求的功能而应传送的数据
- 协议控制信息PCI：控制协议操作的信息
- 协议数据单元PDU：对等层次之间传送的数据单元称为该层的PDU
  - 物理层：比特
  - 数据链路层：帧
  - 网络层：分组
  - 传输层：报文

### 概念

- 协议（水平）：数据格式、同步问题｜｜功能点：线路管理（建立、释放链接）、差错控制、数据转换等
  - 语法：传输数据的格式
  - 语义：所要完成的功能，需要发出何种控制信息，完成何种动作以及作出何种应答
  - 同步：执行各种操作的条件、时序关系
- 接口：同一节点内相邻两层间交换信息的连接点，是一个系统内部的规定。
  - 服务访问点SAP：实体通过SAP进行交互，逻辑接口。
    - 数据链路层：MAC地址
    - 网络层：IP地址
    - 传输层：端口
- 服务（垂直）：请求｜指示｜响应｜证实
  - 面向连接服务/无连接服务
  - 可靠服务/不可靠服务  纠错、检错、应答机制、数据正确、可靠送达
  - 有应答服务/无应答服务   ---    应答是由传输系统内部自动实现｜无应答如果需要应答，则由高层实现

### 模型

#### OSI模型

通信子网：物理层｜数据链路层｜网络层  <u>为了联网而附加的通信设备，完成数据的传输功能</u>

承上启下：传输层

资源子网：会话层｜表示层｜应用层  <u>计算机系统，完成数据的处理等功能</u>



**物理层**

传输单位：比特

任务：透明的传输比特流

功能：在物理媒体上为数据端设备透明地传输原始比特流

物理层接口标准 EIA-232C｜EIA/TIA RS-449｜CCITT的X.21

研究内容：接口参数｜通信链路上传输的信号的意义和电气特征

（物理媒体：双绞线、光缆、无线信道等都在物理层协议下面）

------

**数据链路层**

传输单位：帧

任务：将网络层传来的IP数据包组装成帧

功能：成帧、差错控制、流量控制（协调两个结点的速率）、传输管理（点到点的服务，主机到主机之间的通信）

 ｜广播式网络还要处理新的问题：如何控制对共享信道的访问->介质访问子层

协议：SDLC｜HDLC｜PPP｜STP｜帧中继

------

**网络层**

传输单位：分组/数据报

任务：把网络层的PDU分组从源端传送到目的端，为分组交换网上的不同主机提供通信服务。

功能：路由选择、流量控制、拥塞控制、差错控制、网际互联

（大量的异构网络通过 <u>路由器</u>互联）

协议：无连接的网际协议IP｜IPX｜ICMP｜IGMP｜ARP｜RARP｜OSPF

------

协议：无连接的网际协议IP｜IPX｜ICMP｜IGMP｜

**传输层**

传输单位：报文段（TCP）/数据报（UDP）

任务：负责两个进程之间的通信

功能：**为端到端**提供可靠的传输服务、流量控制、差错控制、服务质量、数据传输管理（端到端：进程【不同主机内】端口号）

​			复用：<u>多个</u>应用层进程可同时使用下面传输层的服务

​			分用：传输层把收到的信息<u>分为交付</u> 给上面应用层中相应的进程

​			（因为一台主机可以同时运行多个进程）

协议：TCP｜UDP

------

**会话层**

服务：允许不同主机上的各个进程之间进行会话。建立->管理->终止进程间的会话

增值服务：建立同步SYN->为表示层实体或用户进程建立连接并在连接上有序地传输数据

使用 <u>校验点</u> 使通信会话在通信失效时从校验点继续恢复通信，实现数据同步。ADSP ASP

------

**表示层**

任务：处理在两个通信系统中交换信息的 <u>表示方式</u>

功能：抽象的标准方法定义数据结构，采用标准的编码形式。数据压缩、加密、解密

------

应用层

用户与网络的界面，产生流量的程序

协议：FTP｜SMTP｜HTTP

#### TCP/IP模型

来源：ARPAnet

网络接口层（物理层、数据链路层）｜网际层｜传输层｜应用层（会话层、表示层、应用层）

网络接口层：指出主机必须使用某种协议与网络连接，以便在其上传递IP分组｜作用：从主机或结点接收IP分组，并把它们发送到指定的物理网络上。

网际层：不保证分组有序到达，分组的有序交付由高层负责。

传输层：发送端和目的端主机上的对等实体进行会话。

应用层

#### 对比

- 相似

  - 都采用分层的体系结构，分层的功能也大体相似
  - 基于独立的协议栈
  - 解决异构网络的互联

- 区别

  |                OSI                 |                        TCP/IP                        |
  | :--------------------------------: | :--------------------------------------------------: |
  | 服务、协议、接口（软件工程的思想） |                   没有概念上的划分                   |
  |    模型产生于协议之前，通用性好    |             协议产生在模型之后，通用性差             |
  |          后来加入了IP层层          | 设计之初考虑到了多种异构网的互联问题，IP作为单独一层 |
  |      网络层：无连接&面向连接       |                    网际层：无连接                    |
  |          传输层：面向连接          |               传输层：无连接&面向连接                |

  

# 物理层

## 2.1通信基础

### 概念

数据：传送信息的实体

信号：数据的电气或电磁表现，数据在传输过程中的存在形式

模拟的：连续变化的

数字的：有限离散数值的

串行传输：一个一个的比特按照时间顺序传输

并行传输：多个比特通过多条通信信道同时传输

码元：用一个固定时长的信号波形（数字脉冲）表示一个k进制数字（数字通信中数字信号的计量单位）

​								这个时长内的信号称为k进制码元，时长称为 **码元宽度**

​			1码元可以携带多个比特的信息量 （一个码元对应的二进制位数是有限的

------

数据通信：数字计算机或其它数字终端之间的通信｜数据通信系统主要划分为信源、信道、信宿

信源：产生和发送数据的源头

信宿：接收数据的终点 （终端装置）

信道：信号的传输媒介

​		传输信号分类：模拟信道｜数字信道

​		传输介质分类：无线信道｜有线信道

基带信号：数字信号1和0直接用两种不同的电压表示，然后传送到*数字信道*上传输（基带传输）

宽带信号：将基带信号调制后形成 <u>频分复用模拟信号</u> 然后送到*模拟信道*上去传输 （宽带传输）

单工通信：一个方向，一条信道

半双工通信：双向，不能同时发送和接收，两条信道

全双工通信：同时发送/接收，两条信道

信道的 **极限容量** ：信道的最高码元传输速率/信道的极限信息传输速率

------

码元传输速率（波形速率、调制速率、符号速率）：单位时间内数字通信系统所传输的 *码元个数*   单位： **波特Baud** 一波特表示数组通信系统每秒传输一个码元

​		<u>码元速率与进制数无关</u>  与码元长度有关

信息传输速率（比特率）：单位时间内数字通信系统传输的<u>二进制码元个数</u> 单位：比特/秒 b/s

～ 一个码元携带n比特的信息量，则M波特率的码元传输速率对应的信息传输速率为Mn 比特/秒

### 定理

#### 奈奎斯特定理

理想低通的信道中，*极限码元传输速率* 为2W波特（W为理想低通信道的带宽，Hz）若用V表示每个码元离散电平的数目（多少种不同的码元）

​																	理想低通信道下的极限数据传输率=2Wlog<sub>2</sub>V			b/s

结论

​		任何信道，码元传输的速率是有上限的。超过上限，会出现码间串扰

​		信道的频带越宽，就可用更高的速率进行码元的有效传输

​		仅给出了码元传输速率的限制，未对信息传输速率进行限制（一个码元可以对应多少个二进制位）

​			提高数据的传输速率，必须设法使每个码元携带更多个比特的信息量->采用多元制的调制方法

#### 香农定理

带宽受限且有高斯白噪声干扰的信道的极限数据传输率

​																	信道的极限数据传输率=Wlog <sub>2</sub>(1+S/N)				b/s

W为信道的带宽，S为信道所传输信号的平均功率，N为信道内部的高斯噪声功率。S/N为信噪比：信号的平均功率与噪声的平均功率之比

信噪比 = 10log<sub>10</sub>(S/N) 单位为dB

结论

​		带宽/信噪比越大，传输率越高

​		对于一定的传输带宽和一定的信噪比，传输速率的上限时确定的

​		只要信息的传输速率低于信道的极限传输速率，就可以实现无差错的传输

​		实际情况下的速率低于香农



### 编码、调制

调制：把数据变换为模拟信号的过程

编码：把数据变换为数字信号的过程

数字数据 - 数字信号（数字发送器）-> 基带传输

​			 	- 模拟信号（调制器）

模拟数据 - 数字信号（PCM编码器）

​                 - 模拟信号（放大器）

1. 数字数据编码为数字信号

   【用于基带传输，不改变频率】

   1）非归零编码	没有检错功能，无法判断一个码元的开始和结束，双方难以维持同步

   2）曼彻斯特编码	将一个码元分成两个相等的间隔，高低-1｜低高-0 （电平跳变）位中间的跳变既可以作为时钟信号【同步】，也可以作为数据信号。**以太网**

   3）差分曼彻斯特编码	码元为1，则前半个码元的电平与上一个码元的后半个码元电平相同。	每个码元的中间都有一次电平的跳转，<u>实现自同步，抗干扰性好</u> **局域网传输**

   4）4B/5B编码	数据流每4位作为一组，然后转换为5位码。32种组合只采取其中16位对应的16种不同的4位编码，其它的16位作为控制码或保留。

2. 数字数据调制位模拟信号

   【发送端调制，接收端解调】

   1）幅移键控ASK	改变信号的振幅，频率和相位不变 抗干扰差

   2）频移键控FSK	改变信号的频率，振幅和相位不变 抗干扰强

   3）相移键控PSK	改变信号的相位，振幅和频率不变 分为绝对调相和相对调相

   4）正交振幅调制QAM	频率相同的前提下，将ASK和PSK结合起来。

   ​			波特率B，采用m相位，每个相位都有n种振幅，则数据传输率R=Blog<sub>2</sub>(mn) 	b/s

3. 模拟数据编码为数字信号

   音频信号进行编码的 <u>脉码调制PCM</u>

   采样：f<sub>采样</sub>>=最大频率f的二倍 奈奎斯特定理

   ​			对模拟信号进行周期性扫描，把时间上连续的信号变成时间上离散的信号【分割】

   量化：取得的电平幅值按照一定的分级表度取整【转换】

   编码：把量化的结果转换为与之对应的二进制编码

4. 模拟数据调制为模拟信号

   频分复用FDM

### 交换

#### 电路交换

建立一条专用的【双方独占】物理通信路径 直通式「没有存储转发」

三个阶段：连接建立、数据传输、连接释放

KEY：传输过程中，用户始终占用端到端的固定传输带宽。

AD：时延小｜有序传输｜没有冲突｜适用范围广｜实时性强｜控制简单

DIS：建立连接时间长｜线路独占，利用率低｜灵活性差｜难以规格化

#### 报文交换

AD：无需建立连接｜动态分配线路｜提供线路可靠性｜提高线路利用率｜提供多目标服务

DIS：转发时延｜网络节点需要较大的缓存空间

#### 分组交换

限制每次传送的数据块大小的上限，把大的数据块划分为合理的小数据块，再加上一些必要的控制信息【源地址、目的地址、编号】构成分组Packet

AD：无需建立时延｜线路利用率高【在不同的时间，一段一段地部分占有这条物理链路】｜简化了存储管理【缓冲区大小固定】｜加速传输｜减少了出错概率和重发数据量

DIS：传输时延｜需要 传输额外的信息量｜采用*数据报服务*时，会出现失序、丢失、重复分组，目的点需要重新排序｜采用*虚电路服务*没有失序问题，但有建立、数据传输、虚电路释放三个过程

分类：1. 面向连接的虚电路方式 2. 无连接的数据报方式 **网络层提供**

### 数据报、虚电路

|                    |                          数据报服务                          |                          虚电路服务                          |
| :----------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|     连接的建立     |                            不需要                            |                            必须有                            |
|      目的地址      |                  每个分组都有完整的目的地址                  | 仅在建立连接阶段使用，之后的每个分组使用长度较短的**虚电路号** |
|      路由选择      |                每个分组独立进行路由选择与转发                |  体现在连接建立阶段，属于同一条虚电路的分组按照同一路由转发  |
|      分组顺序      |                          不保证有序                          |                      保证正确且有序到达                      |
|       可靠性       |               不保证可靠性，由**用户主机**保证               |                     可靠性由**网络**保证                     |
| 对网络故障的适应性 | 出故障的结点丢失分组，其它分组路径选择发生变化时可以正常传输 |            所有经过故障结点的虚电路均不能正常工作            |
| 差错处理和流量控制 |         **用户主机**进行流量控制，不保证数据报可靠性         |       可由**分组交换网**负责，也可以由**用户主机**负责       |

【虚电路的“虚”是指这条电路不是专有的，每个节点到其它节点之间的链路可能 <u>同时由若干虚电路</u> 通过】

## 2.2传输介质

### 介质

- 双绞线	绞合可以减少对相邻导线的电磁干扰

  - 屏蔽双绞线STP 进一步提高抗电磁干扰能力（金属丝编织）
  - 非屏蔽双绞线UTP

  【带宽取决于铜线的粗细和传输的距离】

  模拟传输 - 使用放大器放大衰减的信号

  数字传输 - 中继器将失真的信号整形

- 同轴电缆   良好的抗干扰特性（外导体屏蔽层）

  - 基带同轴电缆（50欧姆） - 局域网
  - 宽带同轴电缆（75欧姆） - 有限电视系统

- 光纤   全反射

  - 多模光纤 - 近距离传输 ｜ 光源为发光二极管
  - 单模光纤 - 远距离传输 ｜ 光源为激光二极管，光线不会产生多次反射

- 无线传播介质

  - 无线电波 - 较强的穿透能力，信号向所有方向散播
  - 微波、红外线、激光 - 高带宽的无线通信
    - 发送方和接收方之间存在一条 <u>视线</u> 通路，有很强的方向性，直线传播

### 接口特性

【物理层尽可能屏蔽各种物理设备的差异，使数据链路层只需要考虑本层的协议和服务】

- 机械特性：定义物理连接的 <u>边界点（接插装置）</u>。规定物理连接时采用的 <u>规格、引线的数目、引脚的数量和排列情况</u>
- 电气特性：规定传输二进制位时，线路上信号的 <u>电压高低、阻抗匹配、传输速率、距离限制</u>
- 功能特性：某条线上出现的某一电平的 <u>电压的意义</u>，接口部件的信号线（数据线、控制线、定时线）用途
- 规程特性（过程特性）：定义各条物理线路的工作规程和时序关系

**接口标准**：EIA RS-232-C、ADSL、SONET/SDH

## 2.3设备

### 中继器（转发器）

功能：将信号整形并放大再转发出去|消除失真和衰减【没有存储转发】

原理：信号再生

端口：两个。仅作用于*信号的电气部分*|数据从一个端口输入，再从另一个端口输出

应用：局域网【使用中继器连接的几个网断仍然是一个局域网】【不能连接两个具有不同速率的局域网】

​		【中继器两端的网络部分是 **网段** ，不是子网】【中继器有故障，两端都受影响】【两端的网段一定要使用同一种协议】

​		【本层及本层以下协议相同，本层以上协议可以不同】

原则：5-4-3规则

​			互相串联的中继器不能超过4⃣️个，而且4个中继器串联起来的5⃣️段通信介质中只有3⃣️段可以挂接计算机，其余两段只能 <u>用作扩展通信范围的链路段</u>

|   放大器放大模拟信号｜将衰弱的信号放大   |
| :--------------------------------------: |
| 中继器放大数字信号｜将衰弱的信号整形再生 |

### 集线器Hub

本质：多端口的中继器

功能：信号放大｜转发作用 -> 转发：除了输入端口外的其它端口【没有寻址功能】

目的：扩大网络的传输范围

介质：双绞线，直接与交换机相连

分类：物理上是星形结构，逻辑上总线网｜半双工

【所有集线器的端口属于同一冲突域】【效率平均】



# 数据链路层

链路：从一个结点到相邻结点的一段物理线路，中间没有其他任何的交换结点

数据链路：在一条线路上传送数据，既要有一条物理线路，还要有通信协议。把实现协议的硬件和软件加到链路上，就构成了数据链路

## 3.1功能

将网络层提供的可能出错的物理连接改造为<u>逻辑上无差错</u>的数据链路

- 为网络层提供服务 - 将源机器中来自网络层的数据传输到目标机器的网络层
  - 无确认的无连接服务
    - 丢失的帧，数据链路层不负责重发而交给上层处理
    - 实时通信/误码率较低的通信信道 **以太网**
  - 有确认的无连接服务
    - 目标机器收到数据帧必须发回确认
    - 误码率较高的通信信道 **无线通信**
  - 有确认的面向连接服务
    - 建立数据连接、传输帧、释放数据链路
    - 确认后继续发送帧
- 链路管理 - 数据链路连接的 <u>连接、维持、释放过程</u>
  - 面向连接，交换信息对 **帧序号** 初始化。
  - 要求通信的站点间分配和管理新到哦
- 帧定界、帧同步、透明传输
  - 分组封装成帧：数据前后分别添加首部和尾部，构成帧
    - 首部尾部作用：确定帧的界限。
  - 帧同步：接收方可以从收到的比特流中区分出帧的起始和终止
  - 透明传输：不管所传的数据是什么样的比特组合，都能在链路上传送。
- 流量控制：限制发送方的数据流量，发送速率不超过接收方的接受能力
  - 控制的是 <u>相邻两结点</u> 之间数据链路层上的流量
- 差错控制：发送方确定接收方是否正确收到其发送的数据
  - 位错：循环冗余校验CRC - 发现位错｜自动重传ARQ - 重传出错的帧
    - 发送方将要发送的数据帧附加一定的CRC荣誉校验码一并发送，接收方则根据检错码对数据帧进行错误检测，若发现错误则丢弃，发送发超时重传该数据帧
  - 帧错：帧的丢失、重复或失序。   定时器 - 丢失｜编号机制 - 重复/失序

## 3.2组帧

原因：出错时只需要重发出错的帧

作用：帧定界、帧同步、透明传输

tip：组帧既要有首部也要有尾部。【网络中的信息是以帧为最小单位进行传输的】

​			分组（IP数据报）仅是包含在帧中的数据部分，所以不需要加尾部来定界。

- 字符计数法 - 帧头部使用一个计数字段来标明帧内字符数
  - 计数字段出错
- 字符填充的收尾定界符法 - 开始符，结束符，转义符
- 比特填充的首尾标志法
  - 01111110标志开始&结束｜信息位遇到5个连续的1时，自动的在其后插入一个0
  - 硬件实现，优于字符填充
- 违规编码 - 物理层进行比特编码
  - 局域网IEEE802采用这种方法
  - 适合采用冗余编码的特殊编码中 - 曼彻斯特编码中 高高 低低属于违规

## 3.3差错控制

差错来源噪声

噪声分类：

​	1）信道固有的、持续存在的 <u>随机热噪声</u>   - 提高信噪比

​	2）外界特定的短暂原因造成的冲击噪声 - 主要原因

### 检错编码

冗余编码技术 - 添加冗余位，构成新的码字后发送，冗余位会随着数据变化。接收端根据码字是否符合原规定来判断是否出错。

- 自动重传请求 ARQ - 接收端检测到出错时，就设法通知发送端重发，直到接收到正确的码字为止

- 奇偶校验 - n-1位信息元+1位校验元
  - 奇校验码 - 附加校验元之后，n长码字中 1 的个数位奇数
  - 偶校验码 - 附加校验元之后，n长码字中 1 的个数位偶数
  - 垂直奇偶校验、水平奇偶校验、水平垂直校验
- 循环冗余码CRC （多项式码）- m bit的帧 + r bit的序列 <u>帧检测序列FCS</u>（余数）
  - 双方商定多项式G（x）高位低位都是1 - 带校验码的帧正好被预先确定的多项式整除
  - m帧补0⃣️（多项式最高位个）➗多项式得到余数 余数补到m帧后面发送出去
  - 除法原则：加法不进位，减法不借位 

### 纠错编码

- 前向纠错FEC - 接收端不但能发现差错，也能确定二进制数码的错误位置从而加以纠错

- 海明码 - 发现双比特错误，纠正单比特错

  - 从左至右编号，编号为2的幂次是校验位

  - m位信息位插入r个校验位组成m+r位码字，满足关系 2<sup>r</sup>>=m+r+1

    数据位	1	2	3	4	5	6	7	

    代    码    P<sub>1</sub>  P<sub>2</sub>  D<sub>1</sub>  P<sub>3</sub>   D<sub>2 </sub> D<sub>3</sub>  D<sub>4</sub> 

    3=1+2｜5=1+4｜6=2+4｜7=1+2+4

    P<sub>1</sub> 异或D<sub>1</sub>异或D<sub>2</sub>异或D<sub>4</sub>=0 	（*） 得到P<sub>1</sub>的值

    如果发生错误，接收方重新计算（*）三个结果，先计算的放在低位，得到二进制编码，换算成十进制数，得到出错位。

  - 纠错d位，需要码距为2d+1的编码方案｜检测d位，需要码距为d+1｜纠错d位，检错e位，需要码距为d+e+1的编码方案

## 3.4流量控制、可靠传输

- 停止-等待流量控制基本原理

  发送方每发送一帧都要等待应答信号，之后才能发送下一帧

  接受方每接收一帧都要反馈一个应答信号，表示可以接受下一帧

- 滑动窗口流量控制基本原理

  - 发送窗口：发送方维持一组连续的允许发送的帧的序号
  - 接受窗口：接收方维持一组连续的允许接收的帧的序号
  - 发送窗口大小W<sub>T</sub>：表示还未收到对方确认信息的情况下发送方最多还可以发送多少个数据帧

  【窗口的大小在传输过程中是固定的】【接收窗口为1可以确保帧的有序接收】

- 可靠传输机制

  - 确认 - 无数据的控制帧
    - 捎带确认 - 把确认捎带在一个回复帧中
  - 超时重传 - 发送方在发送某个数据帧后就开启计时器
    - 停止-等待ARQ
    - 后退N帧ARQ
    - 选择性重传SR ARQ

【流量控制与可靠传输是交织在一起的】

### 单帧滑动窗口&停止-等待协议

发送窗口与接收窗口都为1

- 到达目的站的帧可能已遭破坏
  - 丢弃
  - 计时器
- 数据帧正确但确认帧被破坏 - 接收方收到正确的数据帧，发送发收不到确认帧
  - 发送方会重传已被接收的数据帧，接收方收到同样的数据帧会丢弃该帧，并重传一个该帧对应的确认帧
- 步骤
  - 数据帧的副本会保留在发送缓存中，收到确认帧之后可以清除副本
  - ACK0、ACK1交替使用
  - 连续出现相同序号的确认帧时，表明接收端收到了重复帧

信道利用率：发送方在一个发送周期内，有效地发送数据所需时间占整个发送周期的比率

（L/C）/T

L：T内发送L比特数据｜C：发送方的数据传输率｜T：发送周期//从开始发送数据到收到第一个确认帧为止。

信道吞吐率 = 信道利用率*发送方的发送速率 L/T

### 多帧滑动窗口&后退N帧协议GBN

发送窗口>1，接收窗口=1

接收方检测出失序的信息帧后，要求发送方重发最后一个正确接收的信息帧之后*所有未被确认*的帧

**接收方只允许按顺序接收帧** 接收方可以连续收到好几个正确的数据帧后，对最后一个帧发确认信息/捎带确认

【对某个帧的确认表明该数据帧以及其之间的所有帧均正确无误收到】

【出现错误之后，需要重复发送已发送的最后一个确认帧，防止其丢失】

### 多帧滑动窗口&选择重传协议SR

发送窗口>1，接收窗口>1

每个发送缓冲区对应一个计时器

NAK否定帧：一旦接收方怀疑帧出错，就会发送一个否定帧给发送发，要求发送方对NAK中指定的帧进行重传

帧编号n：接收窗口W<sub>R</sub>+发送窗口W<sub>T</sub><=2<sup>n</sup>		 W<sub>Rmax</sub>=W<sub>Tmax</sub>=2<sup>n-1</sup> 

​					一般，SR协议中，接收窗口大小和发送窗口大小是相同的

接收端缓冲区的数目等于窗口的大小

## 3.5介质访问控制

任务：为使用介质的每个结点隔离来自同一信道上其他结点所传送的信号，以协调活动结点的传输。

**介质访问控制子层MAC**：用来决定广播信道中信道分配的协议 属于数据链路层的一个子层

方法：信道划分介质访问控制｜随机访问介质访问控制｜轮询访问介质访问控制

### 信道划分介质访问控制

多路复用技术：多个信号组合在一条物理信道上进行传输，多个计算机或终端设备共享信道资源，提高信道利用率

- 频分多路复用FDM

  - 信号调制到不同频率载波上，再叠加形成一个复合信号
  - 每个子信道分配的带宽可以不同，但是总和必须不超过信道的总带宽。｜相邻信道之间加上“保护频带”
  - 优点：充分利用传输介质的带宽，系统效率较高

- 时分多路复用TDM

  - 物理信道按时间分成若干时间片，轮转供信号使用
  - 统计时分多路复用STDM 动态分配时隙

- 波分多路复用WDM

  - 光的频分多路复用
  - 合波器｜分波器｜波长不同，各路光信号互不干扰

- 码分多路复用CDM

  - 采用不同的编码来区分各路原始信号｜既共享信道的频率，又共享时间

  - **码分多址CDMA**：每比特时间被分为m个更短的时间槽，称为 <u>码片Chip</u> 各个站点的码片序列相互正交

  - S表示A站的码片向量，T表示B站的码片向量。不同站的码片序列正交 接收端收到的序列为S-T 

    接收端需要分离出来A站和B站发送的数据，S（S-T）-〉A|T（S-T）-〉B

### 随机访问介质访问控制

为了解决随机接入发生的碰撞，每个用户需要按照一定的规则反复地重传它的帧，直到该帧无碰撞地通过

【争用型协议】【既不共享时间，也不共享空间】

实质：将广播信道转化为点到点信道

#### ALOHA协议

- 纯ALOHA协议 - 每个站点不检测直接发送数据，没有收到确认就认为发生冲突
  - 碰撞都重传
  - 重传机制：等待一段随机的时间
- 时隙ALOHA协议 - 所有站在时间上同步起来，将时间划分为一段段等长的时隙Slot **只能在时隙开始时才能发送一个帧**
  - 每个帧在到达后，一般要在缓存中等待一段小于时隙的时间，然后送出去。
    - 如果一个时隙内有两个或者两个以上的帧到达时，下一个时隙将会产生碰撞
  - 重传机制：等待一段随机的时间

#### CSMA协议

载波侦听多路访问Carrier Sense Multiple Access【每个站点在发送之前都先侦听一下公用通道，发现信道空闲之后再发送】

【载波侦听装置】

【冲突停发，随机重发】

- 1-坚持CSMA

  - 思想
    - 空闲：立即发送数据（发送概率为1）
    - 忙：等待，继续侦听直到信道空闲
    - 冲突：等待一段随机时间，重新开始侦听
  - 出错/影响
    - 传播时延 - A发送数据给B，A要发送数据的信号还没到达B，B侦听到空闲传数据
    - 继续侦听 - A发数据，B、C都侦听到忙，A发送结束，BC都立刻发送数据

- 非坚持CSMA

  - 思想
    - 空闲：立即发送数据
    - 忙：放弃侦听，等待一段随机时间重复上述过程
  - 出错/影响
    - 增加数据在网络中的平均时延

- p-坚持CSMA（时分信道）

  - 思想

    - 空闲：以概率p发送数据，以概率1-p推迟到下一个时隙，下一个时隙仍然空闲，重复
      - 持续到数据发送成功 / 其他结点发送数据而检测到信道忙为止->等待随机时间后重新开始侦听
    - 忙：等待下一个时隙再侦听

  - 目的：降低1-坚持CSMA协议中 *多个结点检测到信道空闲后同时发送数据的冲突概率* 

    ​			克服非坚持CSMA协议中由于随机等待而造成的延迟时间较长

#### CSMA/CD协议

载波侦听多路访问/碰撞检测Carrier Sense Multiple Access with Collision Detection【发送前先侦听】【边发送边侦听】

【总线形网络/半双工网络】【有线】

【先听后发，边听边发】【**适配器**边发送数据边检测信道上信号电压的变化情况】

- 流程

  - 适配器从父节点获得一个网络层数据报，准备一个以太网帧，并把该帧放到适配器缓冲区中

  - 空闲：传输｜忙：等待直至侦听到没有信号能量

  - 传输过程中没有侦听到来自其他适配器的信号能量，帧完成传输

    否则，停止传输帧，传输一个 **48比特的拥塞信号**

  - 中止后，适配器采用 **截断二进制指数退避算法** 等待一段随机时间后返回step2

- 总线的传播时延

  - a为单程传播时延。t=0时，A发送数据，B监测到信道空闲。t=a-b时，A发送的数据还未到达B，B检测到空闲开始发送数据，

    t=a-b/2时，发生碰撞且A、B不知道发生了碰撞。t=a时，B检测到碰撞停发数据，t=2a-b时A检测到碰撞，停止发送数据

    所以以太网只能采用半双工通信

  - 争用期2a（冲突窗口）

    - 发送完帧之前就能收到自己发出去的数据 ｜帧的传输时延至少两倍于信号在总线中的传播时延｜数据帧必须大于一个最小帧长

      ​								最小帧长 = 总线传播时延 * 数据传输率 * 2（传播时延单位是时间 = 争用期/2）

    - 以太网最小帧长为64B｜发送小于64B的帧，需要在MAC子层中于数据字段的后面加入一个整数字节的**填充字段**

- 二进制指数退避算法

  - 退避时间 = 争用期2a
  - 参数k，重传次数，不大于10
  - 从整数集[0,1,...,2<sup>k</sup>-1]中随机取一个数r，退避时间为2ar
  - 重传达16次都不成功，<u>抛弃此帧并向高层报告出错</u>（网络太拥挤）

#### CSMA/CA协议

载波侦听多路访问/碰撞避免	Carrier Sense Multiple Access with Collision Avoidance

【碰撞避免：并不是协议可以完全避免碰撞，而是协议的设计要尽量降低碰撞发生的概率】

【无线局域网802.11】【接收信号强度远小于发送信号的强度，无线介质上信号强度的动态变化范围很大，实现碰撞检测硬件花销大】

【无线通信存在“隐蔽站”问题】【如果遇到冲突，也要把整个帧传完】

- 碰撞避免
  - 二进制指数退避算法 - 只有正式发送第一个数据帧时不使用退避算法
  - 预约信道：发送方发送数据的同时向其他站点通知自己 **传输数据的时间长度** 以便其他站点这段时间不要发送数据
  - ACK帧：站点在正确接收到发送给自己的数据帧后（除了广播帧和组播帧）都要返回一个ACK帧。发送方未收到ACK帧说明发送失败，重发。直到收到ACK帧/16次以上
  - RTS/CTS帧（可选）解决隐蔽站问题 （由于距离太远而导致一个站点无法检测到介质竞争对手的存在）【相对隐蔽】
    - Request to send 发送者发送RTS，包括接收者地址、发送数据帧时间、发送ACK时间
    - Clear to send 接收者用CTS回应，CTS为发送者预留带宽同时通告所有站点（包括隐蔽的）保持静默
    - 【设备发送帧前，先发送一个很小的RTS帧给目标端，等待目标端回应CTS帧后，才开始传送。此方式可以保证接下来传送资料时不会发生冲突。同时由于RTS、CTS帧都很小，让传送的无效开销变小

|          | CSMA/CD                    | CSMA/CA                                                      |
| :------- | -------------------------- | ------------------------------------------------------------ |
| 冲突     | 检测冲突，无法避免         | 发包的同时不能检测到信道上有无冲突，本结点处没有冲突并不意味着在接收结点处就没有冲突，只能尽量避免 |
| 传输介质 | 总线形以太网               | 无线局域网 802.11a/b/g/n                                     |
| 检测方式 | 通过电缆中的电压变换来检测 | 能量检测、载波检测、能量载波混合检测                         |

### 轮询访问介质访问控制

用户不能随机发送信息【通过一个集中控制的监控站】【循环地轮询每个结点，再决定信道的分配】

【令牌环局域网】【物理星型，逻辑环形】【负载很高的广播信道】

令牌：一组特殊的比特组合而成的帧 帧中包含目的站的地址

所有站点都转发帧，直到帧回到始发站，并由该始发站撤销该帧。

【帧的目的站除了转发帧之外，还会维持一个该帧的副本】【通过在帧的尾部设置 **响应比特** 来指示已收到此副本】

既不共享时间，也不共享空间

## 3.6局域网

- feature
  - 所有站点共享较高的总带宽（即较高的数据传输率）
  - 较低的时延和较低的误码率
  - 各站为平等关系而非主从关系
  - 能进行广播和组播

- determination ingredient
  - 拓扑结构 ：星行结构｜环形结构｜总线形结构｜星形和总线形结合的复合型结构
  - 传输介质：<u>双绞线</u>｜铜缆｜光线
  - **介质访问控制方式** ：CSMA/CD｜令牌总线｜令牌环
- Special
  - 以太网（IEEE802.3，CSMA/CD）：逻辑总线形，物理星形或拓展星形结构
  - 令牌环（IEEE802.5）：逻辑环形，物理星形
  - FDDI（光线分布数组接口，IEEE802.8）：逻辑环形，物理双环结构

**IEEE802**

对应OSI的 *数据链路层、物理层*｜数据链路层拆分为两个子层：逻辑链路控制LLC子层，媒体接入控制MAC子层

物理层 - 介质访问控制层 - 逻辑链路控制层

- MAC子层 - 接入传输媒体，向上层屏蔽对物理层访问的各种差异，提供对物理层的统一访问接口
  - 组帧｜拆卸帧｜比特传输差错检测｜透明传输
- LLC子层 - 与传输媒体无关，向网络层提供无确认无连接、面向连接、带确认无连接、高速传送

### IEEE 802.3

基带总线型局域网标准【物理层、MAC子层】

802.3局域网简称以太网 CSMA/CD协议

无连接的工作方式：尽最大努力进行交付，提供不可靠服务，对于差错的纠正由高层完成｜不编号，不确认

| 参数         | 10BASE5              | 10BASE2              | 10BASE-T     | 10BASE-FL       |
| ------------ | -------------------- | -------------------- | ------------ | --------------- |
| 传输媒体     | 基带同轴电缆（粗缆） | 基带同轴电缆（细缆） | 非屏蔽双绞线 | 光纤对（850nm） |
| 编码         | 曼彻斯特编码         | 曼彻斯特编码         | 曼彻斯特编码 | 曼彻斯特编码    |
| 拓扑结构     | 总线型               | 总线型               | 星形         | 点对点          |
| 最大段长     | 500m                 | 185m                 | 100m         | 2000m           |
| 最多结点数目 | 100                  | 30                   | 2            | 2               |

网卡：局域网中连接计算机和传输介质的接口｜工作在物理层（只关注比特，不关注高层）

MAC地址：介质访问控制地址｜每块网卡出厂时具有唯一的代码｜用于控制主机在网络上的数据通信

#### MAC帧

MAC地址长 **6字节** 6个十六进制数表示，高24位厂商代码，低二十四位网卡序列号（厂商分配）

广播通信，所有接收方检查MAC帧中的MAC地址。

|   8B   |    6     |   6    |  2   | 46-1500 |  4   |
| :----: | :------: | :----: | :--: | :-----: | :--: |
| 前导码 | 目的地址 | 源地址 | 类型 |  数据   | FCS  |

前导码：使接收端与发送端时钟同步。8字节可以分为两段：前同步码（7）【快速实现MAC帧的比特同步】｜帧开始定界符（1）【表示后面的信息时MAC帧】

（MAC不需要帧结束符 -> 以太网传输数据的时候，各帧之间由一定的间隙，只要确定了帧开始定界符，后面连续的就是同一个MAC帧【数据链路层，帧既需要加首部，也要加尾部】）

类型：指出数据域中携带的数据应该交付给哪个协议实体处理

数据：46（以太网帧最小帧长64，64-6-6-2-4=46）｜1500（规定的MTU）

填充：0-46字节，帧太短时填充帧，使之达到最小长度。

校验码FCS：检验范围->从目的地址段到数据段的末尾，采用32位CRC。不校验前导码

（以上都是DIX Ethernet V2标准的MAC帧格式）

802.3区别：帧起始标志与802.4 802.5兼容｜长度域：取代类型域，指出数据长度

- 高速以太网 速率超过100Mb/s
  - 100BASE-T 以太网
    - 双绞线｜星形拓扑结构｜全双工方式、半双工方式
    - CSMA/CD｜全双工下无冲突，不实用CSMA/CD协议
  - 吉比特以太网 1Gb/s
    - 全双工、半双工｜全双工不使用CSMA/CD
  - 10吉比特以太网
    - 光纤作为传输媒体
    - 全双工方式

### IEEE 802.11

无线局域网 802.11a 801.11b 【制定MAC层协议，运行在多个物理层标准上】

内容：协调访问｜错误控制（解决信道的不确定性）｜适宜的寻址｜关联规程（处理站的可携带型和移动性）｜互联过程（扩展无线站的			通信范围）｜允许用户在移动过程中通信

- 分类

  - 有固定基础设施无线局域网

    - 最小构件：基本服务集（Basic Service Set，BSS）

      - 一个基站（接入点AP）：作用类似于网桥
      - 若干移动站

    - BSS可以孤立｜可以通过AP连接到主干分配系统DS，然后再接入另一个基本服务集，构成扩展的服务集ESS

      - ESS可以通过门桥Portal为无线用户提供非802.11无线局域网的接入

    - 帧头格式 

      - |   2    |    2     |   6   |   6   |   6   |    2     |   6   |  0-2312  |  4   |
        | :----: | :------: | :---: | :---: | :---: | :------: | :---: | :------: | :--: |
        | 帧控制 | 生存周期 | 地址1 | 地址2 | 地址3 | 序列控制 | 地址4 | 有效载荷 | CRC  |

        地址1:接收该帧的mac｜地址2:传输该帧的mac｜地址3:子网链接路由器端口的mac｜地址4:自组织

    - 🌰 一个BSS内部一个移动站通过AP把数据发送出去，这时使用的是802.11协议，AP把数据传输到路由器，此时是802.3协议

  - 无固定基础设施无线局域网自组织网络

    - 没有AP，各移动站点平等关系，都有路由器功能
    - 移动自组织网：一些可移动设备发现在它们附近还有其他可移动设备，并且要求和其他移动设备通信。

### 令牌环网

原理：令牌环网的每一站通过电缆与环接口干线耦合器TCU相连

TCU作用：传递所有经过的帧｜为接入站发送和接收数据提供接口

TCU状态：收听状态｜发送状态

- 流程
  - 令牌帧即使网络空闲也在环路中循环传递
  - 站点有数据要发送的时候，就修改令牌中的一个标志位，并在令牌中附加自己需要传输的数据。令牌就变成了数据帧
  - 接收站复制该数据帧
  - 源站点接收到自己发出去的数据帧就不再转发。发送方可以验证数据帧是否出错
  - 源站点传送完数据后，重新产生令牌

【物理星形，逻辑环形】

【IEEE 802.5】

## 3.7广域网

【因特网的核心】【考虑通信容量必须足够大】

【局域网可以通过广域网与另一个相隔很远的局域网通信】

构成：交换结点机、连接这些交换结点机的链路

#### 交换节点机

在单个网络中转发分组 【路由器在多个网络构成的互联网中转发分组】

功能：将分组存储并转发，点到点连接

### PPP协议

Point to Point Protocol【串行线路】【面向字节】

【检错不纠错 不可靠】【只支持全双工】

【两端可以运行不同的网络层协议，但仍可用同一个PPP进行通信】

从SLIP协议的基础上发展而来的，既可以在异步线路上传输，又可以在同步线路上使用

（SLIP主要完成数据报的传输，没有寻址、数据检测、分组类型识别和数据压缩等功能，只能传送IP分组）

- 组成

  - 链路控制协议LCP。用于 <u>建立、配置、测试和管理数据链路</u> 身份验证
  - 网络控制协议NCP。PPP允许同时采用多种网络层协议，每个不同的网络层协议要用一个相应的NCP来配置为网络层协议建立和配置逻辑联结
  - 一个将IP数据报封装到串行链路的方法。IP数据报是PPP帧的信息部分，长度受最大传送单元MTU的限制

- 帧的格式

  | 1    | 1    | 1    | 2    | 不超过1500B        | 2    | 1    |
  | ---- | ---- | ---- | ---- | ------------------ | ---- | ---- |
  | F    | A    | C    | 协议 | 信息部分//IP数据报 | FCS  | F    |

  - 标志字段F 仍为7E 01111101 前后各占一字节 【转义字节7D】
    - 与标志字段相同
      - 异步线路：字节填充
      - SONET/SDH等同步线路：硬件完成比特填充
  - 地址字段A 0xFF
  - 控制字段C 0x03
  - 协议段 说明信息段中运载的是什么种类的分组｜0x0021表示信息字段是IP数据报
  - 信息段长度可变 点对点使用CSMA/CD协议，没有短帧
  - 帧检验序列FCS CRC 检验区包括 <u>地址字段、控制字段、协议字段和信息字段</u>

- 状态

  - 线路静止状态，不存在物理层连接
  - 检测到载波信号，建立物理连接，线路变为建立状态
  - LCP选项商定，商定成功进入 <u>身份验证状态</u> 双方验证通过进入 <u>网络状态</u>
  - NCP配置网络层，配置成功，进入 <u>打开状态</u>
  - 数据传输
  - 终止



### HDLC协议

高级数据链路控制High-Level Data Link Control【面向比特】

【实现透明传输的*0比特插入法*，易于硬件实现】【全双工】

【CRC校验】【信息帧编号，传输可靠性高】

- 基本配置

  - 非平衡配置：一个主站控制整个链路的工作
  - 平衡配置：链路两端的两个站都是复合站，每个复合站都可以平等地发起数据传输，不需要对方的允许

- 站

  - 主站：负责控制链路的操作｜命令帧
  - 从站：受控于主站，按主站命令操作｜响应帧
  - 复合站：既有主站功能，又有从站功能｜命令帧、响应帧

- 数据操作方式

  - 正常响应方式：非平衡 主站向从站传输数据，从站相应传输。从站只有在主站允许下，才可以响应
  - 异步平衡方式：平衡 每个复合站都可以进行数据传输
  - 异步响应方式：非平衡 从站即使未受到主站的允许，也可以进行传输

- HDLC帧

  | 8     | 8     | 8     | 可变     | 16            | 8     |
  | ----- | ----- | ----- | -------- | ------------- | ----- |
  | 标志F | 地址A | 控制C | 信息info | 帧检验序列FCS | 标志F |

  - 标志F 01111110 【比特填充的首位标志法】

  - 地址A 

    - 非平衡方式，写入 **从站的地址**
    - 平衡方式，写入 **应答站的地址**

  - 控制C：按照第一位/第一二位取值分类

    - 信息帧I	第一位0，用来传输数据信息，或使用捎带技术对数据进行确认
    - 监督帧S   第1，2位分别为1、0，用于流量控制和差错控制，执行对信息帧的确认、请求重发、请求暂停发送
    - 无编号帧U 第1，2位均为1，用于提供链路的建立、拆除等控制功能

    

|          |                       广域网                       |          局域网          |
| :------: | :------------------------------------------------: | :----------------------: |
| 覆盖范围 |                  很广，通常跨区域                  |   较小，通常在一个区域   |
| 连接方式 | 点到点连接，一个结点交换机往往与多个结点交换机相连 |   普遍采用多点接入技术   |
| OSI层次  |          三层：物理层、数据链路层、网络层          | 两层：物理层、数据链路层 |
|  着重点  |                    强调资源共享                    |       强调数据传输       |

相似：都是互联网的重要组成构建，从互联网的角度出发，二者平等

​			连接到一个广域网或者一个局域网上的主机在该网内进行通信时，只需要使用其网络的物理地址

【控制信息来源哪一层，就属于哪一层】

## 3.8设备

### 网桥

工作在数据链路层的MAC子层，可以使以太网各网段成为隔离开的碰撞域。【原来的每个以太网就称为一个网段】

网段：一般指一个计算机网络中使用同一物理层设备（传输介质、中继器、集线器etc）能够直接通信的那一部分

- 网桥特点
  - 具备<u>寻址和路径选择</u>能力，确定帧的传输方向
  - 以目的网络的介质访问控制协议向目的网络转发该帧
  - 连接的两个网段可以使用不同的协议，可以进行协议转换
  - 对接收到的帧不做任何修改，或者只对封装格式做很少的修改
  - 具有足够大的缓冲空间
  - 通过执行帧翻译互联不同类型的局域网//把原协议的信息段的内容作为另一种协议的信息部分封装在帧中
- 优点
  - 过滤通信量
  - 扩大物理范围
  - 使用不同的物理层
  - 互联不同的局域网
  - 可靠性提高、性能改善
- 缺点
  - 增大了时延
  - MAC子层没有流量控制功能（流量控制需要编号机制，编号机制在LLC层）
  - 必要时需要帧格式的转换
  - 容易造成广播风暴 // 只适用于用户数不多和通信量不大的局域网，否则有时还会因传播过多的广播信息而产生网络拥塞

- 分类//路径选择算法

  - 透明网桥（选择的不是最佳路由）

    - 源LAN和目的LAN决定路由选择
      - 相同：丢弃
      - 不同：转发
      - 目的LAN未知：扩散
    - 自学习算法处理帧
      - 网桥每收到一个帧，就记下其源地址和进入网桥的端口，作为转发表的一项
      - 即插即用
      - 生成树算法（无环

  - 源路由网桥（选择的是最佳路由）

    - 源路由网桥对主机是不透明的

    - 源站点以 **广播** 方式向目的站发送一个 **发现帧** 作为探测使用｜发现帧从多个路径到达目的站，目的站也一一发送应答帧

    - 每个应答帧通过原路径返回，途径的网桥把自己的标志记录在应答帧中；源站点选择一个最佳路由

    - 凡是从这源站点向该目的站发送的帧的首部，都必须携带着一路由信息

      【发现帧可以帮助源站 <u>确定整个网络可以通过的帧的最大长度</u> 】【可能出现网络拥塞】

### 交换机

【多端口的网桥】【将网络划分成小的冲突域，为每个工作站提供更高的带宽】

【虚拟局域网VLAN，交换机实现的】【VLAN既可以隔离冲突域，也可以隔离广播域】

- 特点
  - 每个端口都直接与单台主机相连（网桥往往连接到以太网的一个网段）【全双工】
  - 同时连接许多对端口，无碰撞地传输数据
  - 即插即用，转发表自学习建立
  - 交换速率高（专用的交换结构芯片）
  - 独占传输媒体的带宽
    - 普通10Mb/s共享式以太网，N个用户平均带宽1/N
    - 以太网交换机，端口到主机的带宽10Mb/s 交换机的总容量N*10Mb/s

- 交换模式
  - 直通式 - 只检查帧的目的地址6B，速度快缺乏安全性，不支持具有不同速率的端口的交换
  - 存储转发式 - 接收到帧之后缓存到 <u>高速缓存器</u> 中，并检查数据是否正确。确认无误后通过**查找表**转换成 *输出端口* 将该帧转发出去。出错则丢弃｜可靠性高，支持不同速率端口之间的转换｜延迟较大

| 设备名称 | 能否隔离冲突域 | 能否隔离广播域 |
| :------: | :------------: | :------------: |
|  集线器  |      不能      |      不能      |
|  中继器  |      不能      |      不能      |
|  交换机  |       能       |      不能      |
|   网桥   |       能       |      不能      |
|  路由器  |       能       |       能       |

一个网段就是一个冲突域，一个局域网就是一个广播域

# 网路层

## 4.1功能

- 异构网络互联

  - 网络互联：用路由器进行网络互联和路由选择
  - 虚拟IP网络：逻辑互联网络 参加互联的计算机网络都使用相同的网际协议IP
    - 好处：看不见互联的具体的网络异构细节，就好像是在一个统一的网络上通信

- 路由与转发

  - 路由选择Routing：获取网络拓扑结构的变化，动态的选择路由
  - 分组转发Forwarding：根据转发表将用户IP数据报从合适的端口转发出去
    - 路由表根据路由选择算法而来｜转发表从路由表得出

- 拥塞控制

  - 拥塞：因出现过量的分组而引起网络性能下降的现象

    - 路由速率接近链路的带宽时，平均时延急速增加，并且会有大量的分组被丢弃（端口的缓冲区有限）。
    - 判断：如果随着网络负载的增加网络的吞吐量明显小于正常的吞吐量，那网络可能进入“轻度拥塞”｜吞吐量下降到0，死锁

  - 问题：如何获取网络中发生拥塞的信息

  - 作用：确保子网能够承载所达到的流量（全局性的问题）

  - 方法

    - 开环控制。静态，预先考虑因素｜何时可接收新流量、何时可丢弃分组及丢弃哪些分组，确定和中调度决策｜做决定时不考虑当前网络的状态

    - 闭环控制。动态，不提前考虑因素｜监测网络系统取监视，及时检测哪里发生了拥塞，然后将拥塞信息传到合适的地方｜

      ​					基于反馈环路

## 4.2路由算法

### 静态路由

非自适应路由算法。由 <u>网络管理员手动配置</u> 路由信息。发生变化手动修改。

动态路由：自适应路由算法，路由器上的路由表项通过相互连接的路由器之间彼此交换信息，然后按照一定的算法优化出来的。

### 距离向量路由算法DV

所有结点都定期地将它们的 **整个路由选择表** 传送给 **所有与之 <u>直接相邻</u>** 的结点。

构成：路径的目的地 路径的代价

代表RIP

### 链路状态路由算法LS

一个结点检查所有 <u>直接链路</u> 的状态，并将所得的状态信息发送给网上的**所有其他结点**

广播的方式与所有其他结点连接，但只发送与它直接相连的链路的费用

任务：主动测试所有邻接结点的状态。｜定期地将链路状态传播给所有其他结点

代表OSPF

链路发生变化，利用 <u>Dijsktra最短路径算法</u> 重新计算路由，从单一的源出发计算到达所有目的结点的最短路径。

- feature
  - 向本自治系统中所有路由器发送信息，使用 **泛洪法**，路由器通过所有端口向所有相邻的路由器发送信息，而每个相邻路由器又将此信息发往其所有相邻路由器（除去刚刚发来信息的路由器）
  - 发送的信息是与路由器相邻的所有路由器的链路状态，但这只是路由器所知道的部分信息。｜链路状态：本路由器与哪些路由器相邻以及该链路的“度量”｜度量：OSPF中指 - 费用、距离、时延、带宽
  - 只有链路状态发生变化时，路由器才发送此消息

- 优点
  - 路由结点不依赖中间结点的计算
  - 链路状态报文不会被改变，易于查找故障

### 层次路由

自治系统：一个自治系统中包含很多局域网

内部网关协议IGP（域内路由选择） RIP，OSPF｜OSPF把一个自治系统划分为若干区域Area，每个路由器都知道在本区域如何把分组路由到目的地的细节，但不知道其他区域的内部结构

外部网关协议EGP（域间路由选择）用于不同自治系统的路由器之间交换路由信息，负责为分组在不同自治系统之间选择最优的路径 BGP

## 4.3IPv4

### 分组

首部+数据

![IPv4](/Users/maydaylive/Desktop/复习专用存图/IPv4.png)

- 固定部分20B
  - 版本：IP的版本
  - 首部长度：占4位。4B为单位，最大值为60B。
  - 区分服务：如图
  - 总长度：占16位。首部和数据之和的长度，单位为1B。数据包的最大长度2<sup>16</sup>-1=65535B。以太网MTU为1500B。因此IP数据报封装成帧的时，总长度不能超过1500B。
  - 标识：占16位。计数器，每产生一个数据报就+1，并赋值给标识字段。数据报长度超过MTU会产生分片，**分片后，每个数据报片都复制一次标识号**
  - 标志：占3位。
    - 最低位MF，MF=1表示后面还有分片，MF=0表示最后一个分片
    - 中间位DF，DF=0才允许分片
  - 片偏移：占13位。单位为8B。指出分片后，某片在原分组中的相对位置
  - 生存时间：占8位。分组在网络中的寿命。路由器转发分组之前，先把TTL-1。TTL=0时丢弃分组。
  - 协议：占8位。指出该分组携带的数据使用何种协议，即分组的数据部分应该交给哪个传输层协议。TCP，UDP等。TCP-6｜UDP-17
  - 首部校验和：占16位，IP数据报只校验分组的首部，不校验数据部分。
  - 源地址字段：占32位，表示发送方的IP地址
  - 目的地址字段：占32位，表示接收方的IP地址

  总1片8首4

- 分片

  - 标识、标志、片偏移
  - 目的地网络层被重新组装
  - 分片之后也是IP数据报，每一片都有20B的首部

### 地址

IP地址：：={<网络号>，<主机号>}	「两级IP地址」

- A类（1-126）		 0	       网络号（7位）	主机号（24位）
  - 可用网络数：2<sup>7</sup>-2
    - 网络号全为0
    - 网络号为127
- B类（128-191)       10         网络号（14位）  主机号（16位）
  - 可用网络数：2<sup>14</sup>-2
    - 128.0网络号不可指派
- C类（192-223）    110       网络号（21位）  主机号（8位）
  - 可用网络数：2<sup>21</sup>-2
    - 192.0网络号不可指派
- D类（224-239）    1110     多播地址
- E类（240-255）     1111     保留为今后使用

主机号全为0：本网络

主机号全为1:本网络的广播地址（直接广播地址）

127.0.0.0：环路自检地址，表示任意主机本身。目的地址为环路自检地址的IP数据报永远不会出现在任何网络上

0.0.0.0：表示本网络上的本主机

255.255.255.255：整个TCP/IP网络的广播地址（受限广播地址）｜实际使用时，由于路由器对广播域的隔离，等效于本网络的广播地址

- 特点
  - 分等级的地址结构
    - IP地址管理机构只需要分配网络号
    - 路由器仅根据目的主机所连接的网络号来转发分组
  - IP地址标志一台主机（or路由器）和一条链路的接口
    - 一台主机同时连接到两个网络时，主机就必须同时具有两个相应的IP地址，且两个IP地址的网络号不同
  - 转发器、网桥连接的若干LAN仍然是一个网络，所以该LAN下所有主机的IP地址 <u>网络号</u> 必定相同，主机号必定不同
  - 同一局域网上的主机or路由器的IP地址网络号必须一样，路由器总是有两个及以上的IP地址，路由器每个端口都有一个不同网络号的IP地址。

### NAT

Network Address Translation网络地址转换

【通过将专用网络转换为公用地址，从而对外隐藏内部管理的IP地址。】【整个专用网络只需要一个全球IP地址就可以连通互联网】

【专用网本地IP地址是可重用的】

**私有IP地址网段**【私有IP地址只用于LAN，不用于WAN】（私有IP不能直接用于公用地址，需要通过 **网关** 利用NAT把私有IP地址转换为转换为Internet中合法的全球IP地址后才能用于Internet）

- A类：1个A类网段，	**10**.0.0.0 - **10**.255.255.255

- B类：16个B类网段，  **172.16**.0.0 - **172.31**.255.255
- C类：256个C类网段，**192.168.0**.0 - **192.168.255**.255

【私有IP地址也称 <u>可重用地址</u> 】

NAT路由器至少有一个有效的外部全球地址

NAT转换表{本地IP地址：端口} to {全球IP地址：端口}的映射

【NAT路由器在转发IP数据报时，**一定要更换其IP地址（转换源IP/目的IP地址）**】【工作在传输层//涉及到端口号】

### 子网划分

「三级IP地址」【添加 子网号字段】

IP地址={<网络号>，<子网号>，<主机号>}

>子网划分处于单位内部的事情，单位对外仍然表现为没有划分子网的网络。
>
>从主机号借用若干比特作为子网号。
>
>其他网络发送数据报到本单位某台主机，根据IP数据报的目的网络号，先找到本单位路由器。然后路由器在收到IP数据报之后，根据**目的网络号和子网号找到目的子网**。最后把IP数据报交付给目的主机



>RFC 950规定，子网号不能全为1or全为0，CIDR的推广后也可以
>
>主机号全为0or全为1的仍然不能被指派
>
>子网中主机号全为0的地址为子网的网络号，主机号全为1的地址为子网的广播地址

### 子网掩码

1（网络号、子网号）+0（主机号）

默认子网掩码：没有进行子网划分

【子网掩码与IP地址进行AND操作得到子网的网络号】【交换路由信息的时候，需要把自己的子网掩码告诉对方】

【同一个子网下的主机以及路由器的相应端口，必须设置相同的字网掩码】

路由器的路由表：目的网络地址、子网掩码、下一跳地址

使用子网掩码时路由器的分组转发算法：

1. 从收到的分组的首部提取目的IP地址，记为D。
2. 先判断是否是直接交付。对路由器直接相连的网络逐个进行检查：用各网络的子网掩码和D逐位AND操作，看结果是否和相应的网络地址匹配。匹配则直接交付，否则3
3. 若路由表中有目的地址为D的特定主机路由，则将分组传送给路由表中所指明的下一跳路由器；否则4
4. 对路由表中的每一行中的子网掩码和D逐位AND操作，结果为N。若N与该行目的网络地址匹配，则将分组传送给该行指示的下一跳路由器；否则5
5. 若路由表中有一个默认路由，则将分组传送给路由表中所指明的默认路由，否则6
6. 报告转发分组出错

### CIDR无分类域间路由选择

Classless Inter-Domian Routing

【使用“网络前缀”的概念代替子网络的概念】（没有子网概念，CIDR并没有在32位地址中指明若干位作为子网字段

IP地址：：={<网络前缀>,<主机号>}	IP地址/网络前缀所占比特数

【网络前缀都相同的连续IP地址组成 **CIDR地址块** 一个CIDR地址块可以表示很多地址，这种地址的聚合称为 **路由聚合**，或称 **构成超网**】

【路由聚合使得路由表中的一个项目可以表示多个原来传统分类地址的路由，有利于减少路由器之间的路由选择信息的交换】

（超网技术是为了解决路由表的内容冗余问题，是用路由聚合能够缩小路由表的规模，减少路由表的内存）

------

------

**IP地址与硬件地址**

|      |     IP地址     |  硬件地址   |
| :--: | :------------: | :---------: |
| 结构 |   分层次等级   |   平面式    |
| 位置 | IP数据报的首部 | MAC帧的首部 |

IP网络中无法通过广播方式依靠MAC地址来完成跨网络的寻址。IP网络的网络层只能通过IP地址来完成寻址。	

>IP分组通过多次路由转发到达目标网络后，改为在目标LAN中通过数据链路层的MAC地址以广播方式寻址
>
>路由器只根据目的IP地址的网络号进行路由选择
>
>路由器转发IP分组的时候，IP分组在每一个网络中都被路由器解封装和重新封装。IP数据报在被路由器转发时，其数据链路层封装所使用的MAC地址是不断变化的。决定了无法使用MAC地址跨网络通信

【路由器由于互联多个网络，因此它不仅有多个IP地址，也有多个硬件地址。】

### ARP地址解析协议

Address Resolution Protocol 实现IP地址到MAC地址的映射

ARP高速缓存：每台主机都设有，用来存放 **本局域网** 上各主机和路由器的IP地址到MAC地址的映射表（ARP表）

【网络层协议】【解决同一个局域网内的问题】

- 工作原理
  - 主机A欲向本局域网上某台主机B发送IP数据报，先在ARP高速缓存中查看有无主机B的IP地址。
    - 有。可查找出其对应的硬件地址，将硬件地址写入MAC帧。通过局域网将该MAC帧发往此硬件地址。
    - 没有。使用目的地址为FF-FF-FF-FF-FF-FF的帧来封装并**广播**ARP请求分组，使同一个局域网里的所有主机收到ARP请求。主机B收到该ARP请求后，向主机A发送响应ARP分组（**单播**），分组中包含主机B的 <u>IP与MAC地址的映射关系</u>，主机A收到后将此映射写入ARP缓存，然后按查询到的硬件地址发送MAC帧。

- 情况总结

  - 发送方是主机，把IP数据报发送到本网络上的另一台主机。这时用ARP找到目的主机的硬件地址。
  - 发送方是主机，把IP数据报发送到另一个网络上的一台主机。这时用ARP找到本网络上的一个 **路由器的硬件地址**，剩下的工作由这个路由器来完成。
  - 发送方是路由器，把IP数据报发送到本网络上的一台主机。这时用ARP找到目的主机的硬件地址。

  - 发送方是路由器，把IP数据报发送到另一个网络上的一台主机。这时用ARP找到本网络上的一个 **路由器的硬件地址**，剩下的工作由这个路由器来完成。

### DHCP动态主机配置协议

Dynamic Host Configuration Protocol【给主机动态地分配IP地址】【即插即用】【计算机加入新的网络和获取IP地址而不用手工参与】

【应用层协议UDP】【客户/服务器模式】【广播】

需要IP地址的主机在启动时就向DHCP服务器 **广播** 发送 **发现报文** 

本机网络上所有主机都能收到此广播报文，但只有DHCP服务器才回答此广播报文

DHCP服务器先在数据库中查找该计算机的配置信息。若找到，则返回找到的信息。找不到，则从服务器的IP地址池中取一个地址分配给该计算机。回答报文称为 **提供报文**

DHCP服务器聚合DHCP客户端的交换过程如下：

1. 客户机<u>广播</u> **DHCP发现** 消息，试图找到网络中的DHCP服务器，服务器获得一个IP地址。
2. 服务器收到 DHCP发现消息后，向网络中 **广播 DHCP提供** 消息，其中包括提供DHCP客户机的IP地址和相关配置信息。
3. 客户机收到 DHCP提供消息，如果接收服务器所提供的相关参数，那么 **广播 DHCP请求** 消息向服务器请求IP地址。
4. 服务器<u>广播</u> **DHCP确认** 消息，将IP地址分配给客户机。

客户机收到多个应答消息，选择其中一个，通常是最先到达的。

服务器分配的IP地址是临时的，客户机在有限时间【租用期（服务器决定）】内使用这个地址。

### ICMP网际控制报文协议

Internet Control Message Protocol 【提高IP数据报交付成功的机会】

【网络层协议】【让主机or路由器报告差错和异常情况】

【ICMP报文作为IP层数据报的数据，加上数据报的首部，组成IP数据报发送出去】

- 分类

  - ICMP差错报告报文 - 用于目标主机或到目标主机路径上的路由器向源主机报告差错和异常情况

    - 终点不可达 - 路由器或主机**不能交付数据报**时，就向源点发送终点不可达报文

    - 源点抑制 - 路由器或主机**拥塞而丢弃数据报**时，发送报文，通知源点把数据报的发送速率放慢

    - 时间超过 - 路由器收到生存时间TTL为零的数据报，除丢弃数据报外，还要向源点发送时间超过报文。

      ​				 终点在预先规定的时间内不能收到一个数据报的全部数据报片时，就把已收到的数据报片都丢弃，并向源点发送...

    - 参数问题 - 路由器或主机收到的数据报的首部中有的字段的值不正确时，就丢弃该数据报，并向源点发送参数问题报文

    - 改变路由（重定向）- 路由器把改变路由报文发送给主机，让主机知道下次应该将数据报发送给另外的路由器（可通过更好的路由）

      ------

      不发送ICMP差错报告报文

    - 对ICMP差错报文不再发送ICMP差错报告报文

    - 对第一个分片的数据报片的所有后续数据报片都不发送ICMP差错报告报文

    - 对具有组播地址的数据报都不发送ICMP差错报告报文

    - 对具有特殊地址（127.0.0.0或0.0.0.0）的数据报不发送ICMP差错报告报文

  - ICMP询问报文

    - 回送请求和回答报文
    - 时间戳请求和回答报文
    - 掩码地址请求和回答报文
    - 路由器询问和通告报文

- 应用

  - 分组间探测PING（用来测试两台主机之间的连通性）
    - ICMP回送请求和回答报文
    - PING工作在应用层，直接使用网络层的ICMP，不使用传输层协议
  - Traceroute（用来跟踪分组经过的路有）
    - ICMP时间超过报文
    - 工作在网络层

IP数据报：首部+ICMP差错报告报文

ICMP差错报告报文：ICMP的前8⃣️字节+IP数据报首部+8⃣️字节

## 4.4IPv6

![IPv6](/Users/maydaylive/Desktop/复习专用存图/IPv6.png)

**特点**

- 更大的地址空间 128位 16B
- 扩展的地址层次格式 
- 灵活的首部格式 移除了校验和字段，以减少每一跳的处理时间｜移除了可选字段，路由器通常不对扩展首部进行检查
- 改进的选项
- 即插即用
- 允许协议继续扩充
- 支持资源的预分配
- 只有在包的源结点才能分片，传输路径中的路由器不能分片，所以IPv6不允许分片（IPv4在路由中分片）
- 首部长度是8B的整数倍
- 增大了安全性 **身份验证、保密功能**

【取消了协议字段，换成了下一个首部字段】

**目的地址**

- 单播
- 多播 一对多
- 任播：目的站是一组计算机，但数据报交付时只交付其中的一台计算机，通常是距离最近的一台计算机

**地址格式**

每4位用一个十六进制数表示，并用冒号分隔每16位

缩写：开头是零，域中必须至少有一位数字 如4BF5：0000：0000：039A////4BF5：0：0：39A

​			有相继的0值域 采用双冒号：：，双冒号在一个地址只能出现一次

**IPv4向IPv6过渡采用：双协议栈和隧道技术**

- 双协议栈：完全过渡到IPv6之前，使用一部分主机装有两个协议栈，通过双协议栈进行转换
- 隧道技术：将整个IPv6数据报封装到IPv4数据报的数据部分，使得IPv6数据报可以在IPv4网络的隧道中传输

## 4.5路由协议

**自治系统**	Autonomous System AS

单一技术管理下的一组路由器。这些路由器使用一种AS内部的路由选择协议和共同的度量来确定分组在该AS内的路由，同时还使用一种AS之间的路由选择协议来确定分组在AS之间的路由。

一个自治系统的所有路由器在本自治系统内都必须是联通的。

**域间路由和域内路由**

内部网关协议（Interior Gateway Protocol，IGP）	RIP OSPF

外部网关协议（External Gateway Protocol，EGP）BGP-4

​	使用一种协议将路由选择信息传递到另一个自治系统中

### RIP路由信息协议

Routing Information Protocol 【分布式的基于距离向量】

- 规定
  - 路由器维护从它自身到其他每个目的网络的距离记录（DV）
  - 跳数。规定从一个路由器到直接连接网络的距离为1
  - 好路由即它通过的路由器的数目少
  - 一条路径最多只能包含15个路由器。16表示网络不可达。//防止数据报不断循环，减少网络拥塞可能性
  - 路由器每30秒广播一次RIP路由更新信息
  - 不支持子网掩码的RIP广播，RIP中每个网络的子网掩码必须相同。//RIP2中支持变长子网掩码和CIDR
- 特点
  - 仅和相邻路由器交换信息
  - 交换的信息是当前路由器所知道的全部信息，即自己的路由表。
  - 固定时间间隔交换路由信息
- 算法
  - <目的网络N，距离d，下一跳路由器X>
  - 180秒还没有收到相邻路由器的更新路由表，那么把此相邻路由器记为不可达路由器，即距离为16.
- 优点
  - 简单、开销小、收敛过程较快。
- 缺点
  - 规模小
  - 路由器之间交换的是路由器中的完整路由表，因此网络规模越大，开销也越大。
  - 网络出现故障，会出现慢收敛现象。“坏消息传得慢”

【应用层协议，UDP 端口520】

### OSPF开放最短路径优先

Open Source Path Priority	分布式链路状态LS

- 与RIP区别

  - 向本自治系统中的所有路由器发送信息，洪泛法
  - 发送的信息是本路由器相邻的所有路由器的链路状态（路由器知道的部分信息）
    - 链路状态：本路由器和哪些路由器相邻以及该链路的度量
  - 只有链路状态发生变化时，路由器才用洪泛法向所有路由器发送此信息，更新过程收敛的快
  - 【网络层协议】使用IP数据报传送

- 特点

  - OSPF对于不同的链路可根据IP分组的不同服务类型设置成不同的代价
  - 如果到同一个目的网络有多条相同代价的路径，那么可以将通信量分配给这几条路径【多路径间的负载平衡】
  - 所有OSPF路由器之间交换的分组都具有鉴别功能，因而保证了近在可信赖的路由器之间交换链路状态信息。
  - 支持可变长度的子网划分和CIDR
  - 每个链路状态都有32位的序号，序号越大，状态越新

- 原理

  - 将一个自治系统划分为若干更小的范围，称为区域
    - 好处：将利用洪泛法交换链路状态信息的范围局限于每个区域而非整个自治系统，减少了网络的通信量。

- 分类

  - 问候分组Hello。用来发现和维持邻站的可达性
  - 数据库描述分组。向邻站给出自己的链路状态数据库中的所有链路状态项目的摘要信息
  - 链路状态请求分组。向对方请求发送某些链路状态项目的详细信息
  - 链路状态更新分组。用洪泛法对全网更新链路状态
  - 链路状态确认分组。对链路更新分组的确认

  【确认可达性 - 达到数据库的同步 - 新情况下的同步】

### BGP边界网关协议

Border Gateway Protocol	用于互联网的网关之间。路由表包含已知路由器的列表、路由器能够达到的地址以及到达每个路由器的跳数

【路径向量路由选择协议PV】【选择一条较好路径，不是最优路径】

【应用层，TCP】

- 原理
  - 自治系统管理员选择至少一个路由器作为该自治系统的 **BGP发言人**
  - 发言人之间交换路由信息，首先建立TCP连接、建立BGP会话
  - 所有发言人都交换网络可达性的信息后，各发言人就可以找出到达各个自治系统的较好路由
  - 发言人除了运行BGP外，还要运行该AS内的IGP
- 特点
  - BGP交换路由信息的结点数量级是自治系统的数量级，比AS内部网络数少很多
  - 支持CIDR，路由表包括目的网络前缀、下一跳路由、到达该目的网络所要经历的各个AS序列
  - 刚开始交换整个BGP路由表，之后只需要在发生变化时更新有变化的部分
- 报文类型
  - 打开报文Open。用来与**相邻的**另一个BGP发言人建立关系
  - 更新报文Update。用来发送某一路由的信息，以及列出要撤销的多条路有
  - 保护报文Keepalive。用来确认打开报文并周期性地证实邻站关系
  - 通知报文Notification。用来发送检测到的差错

## 4.6IP组播

【UDP】

主机使用IGMP加入组播组。协议通知本地网络上的路由器关于要接受发送给某个组播组的分组的愿望。

组播仅发送一份数据，只有数据在传输路径出现分岔时才将分组复制后继续转发。

需要路由器的支持 【组播路由器】

**组播地址**

D类地址格式 224.0.0.0 - 239.255.255.255

组播数据报使用D类IP地址作为目的地址，首部中的协议字段值为2，表明IGMP

>数据报尽最大努力交付，不提供可靠交付
>
>组播地址只能用于目的地址
>
>组播数据报不产生ICMP差错报文。若在PING后面键入组播地址，将永远不会有响应
>
>并非所有D类地址都可以作为组播地址

分类：只在本局域网上进行硬件组播｜在因特网的范围内进行组播->最后阶段还是要把组播数据报在局域网上使用硬件组播交付给组播组的所有成员

**硬件组播**

IANA拥有的以太网组播地址范围01-00-5E-00-00-00到01-00-5E-7F-FF-FF，每个地址中，只有 **23位可用作组播** （前25位为01-00-5E-0）

只能和D类IP地址中23位有一一对应关系。D类IP地址中前5⃣️位不能用来构成以太网的硬件地址。

🌰：224.128.64.32和224.0.64.32转换为以太网的硬件传播地都是01-00-5E-00-40-20.

组播IP地址与以太网硬件地址的映射关系不是唯一的，因此收到组播数据报的主机，还要在IP层利用软件进行过滤，把并不是本机的丢弃

### IGMP因特网组管理协议

Internet Group Management Protocol【使路由器知道组播组成员的信息】【TCP/IP】

连接到局域网上的组播路由器必须和因特网上的其他组播路由器协同工作，以便把组播数据报用最小代价传送给所有组成员

<u>IGMP不知道IP组播组包含的成员数，也不知道这些成员分布在哪些网络上。</u>

IGMP让连接到本地局域网的组播路由器知道本局域网上是否有主机参加或退出了某个组播组。

**工作**

1. 当某台主机加入新的组播组时，该主机应向组播组的组播地址发送一个IGMP报文，声明自己要成为成员。本地组播路由器收到报文后，将组成员关系转发给因特网上的其他组播路由器。
2. 组成员关系是动态的。本地组播路由器要周期性地探询本地局域网上的主机，以便确认成员关系。响应，活跃。多次不响应，不再转发该成员关系。

**本质**

找出以源主机为根结点的**组播转发树**，其中每个分组在每条连路上**只传送一次**。

不同组播组对应不同的组播转发树；同一个组播组，不同的源点也有不同的组播转发树。

**路由算法**

1. 链路状态
2. 距离向量
3. 建立在任何路由协议之上，称为 **协议无关的组播PIM**

## 4.7移动IP

概念：支持移动性的因特网体系结构与协议的统称。

​			移动结点以固定的网络IP地址实现跨越不同网段的漫游功能，并保证基于网络IP的网络权限在漫游过程中不发生任何改变。

**功能实体**

- 移动结点 - 具有永久IP地址的移动结点
- 归属代理（本地代理）- 一个移动结点的永久居所称为归属网络，在归属网络中代表移动结点执行移动管理功能的实体称为归属代理
  - 根据移动用户的转交地址，采用隧道技术转交移动结点的数据包
- 外埠代理 - 在外部网络中帮助移动结点完成移动管理功能的实体

【归属代理、外埠代理统称为移动代理】

（动态IP指的是局域网中的计算机可以通过网络中的DHCP服务器动态地获得一个IP地址，不需要用户在计算机的网络中设置指定IP地址，动态IP和DHCP经常会应用在我们的实际工作环境中。

转交地址：本地网络链路上每个本地结点还必须有一个本地代理来为它维护当前的位置信息

移动绑定：（移动结点的本地地址和当前转交地址的联合称谓

移动结点得到一个新的转交地址时，<u>通过绑定向本地代理进行注册</u>，以便本地代理即使了解移动结点的当前位置。

## 4.8设备

路由器：具有多个输入/输出端口的专用计算机

任务：连接不同的网络并完成路由转发

【路由器也可以作为最基础的包过滤防火墙应用】

【存储转发设备实现了某个层次的功能，那么它就可以互联两个在该层上使用不同协议的网段（网络）】

​		路由器：物理层、数据链路层、网络层

​		网桥：物理层、数据链路层

​		【中继器：物理层必须相同！因为中继器是直通式设备】

路由选择部分（控制部分）核心是<u>路由选择处理机</u>

【路由器是面向协议的（TCP/IP、OSI、IPX），网桥与高层协议无关】

**路由表**

路由选择：涉及多个路由器

目的网络IP地址、子网掩码、下一跳IP地址、接口

默认路由：0.0.0.0 	0.0.0.0	-	-	

**转发表**	

转发：把收到的IP数据报根据转发表从合适的端口转发出去，仅涉及一个路由器。

目的站	下一跳（下一步接收者的目的地址，实际为MAC地址）

（可以使用一个默认路由代替所有具有相同吓一跳的项目，并将默认路由设置得比所有其他项目的优先级低）

# 传输层

## 5.1服务

### 功能

1. 进程之间的逻辑通信（传输层之间的通信好像是沿水平方向传送数据，但事实上这两个传输层之间并没有一条水平的物理连接，端到端。
2. 复用、分用。复用：发送方不同的应用进程都可以使用同一个传输层协议传送数据｜分用：接收方的传输层在剥去报文的首部后能够把这些数据正确交付到目的应用进程。
3. 差错检验（首部和数据部分）
4. UDP TCP

### 寻址、端口

端口：能够让应用层的各种应用进程将其数据通过端口向下交付给传输层，以及让传输层知道应当将其报文段中的数据向上通过端口交付给应用层相应的进程。

端口号：应用进程通过端口号进行标识。 **16bit** 只具有本地意义，端口号只标识本计算机应用层中各进程

- 服务端端口号

  - IANA：0-1023

    | FTP  | TENLNET | SMTP | DNS  | TFTP | HTTP | SNMP |
    | :--: | :-----: | :--: | :--: | :--: | :--: | :--: |
    |  21  |   23    |  25  |  53  |  69  |  80  | 161  |

  - 登记端口号：1024-49151这类端口号必须在IANA登记，以防止重复

- 客户端端口号：49152-65535.仅在客户进程运行时才动态选择。

套接字：通信端点   套接字=（主机IP地址，端口号）【唯一地标识网络中的一台主机和其上的一个应用】

### 分类

无连接服务：UDP【TFTP、DNS、SNMP、RTP】

面向连接服务：TCP【FTP、HTTP、TELNET】

## 5.2UDP

服务：复用分用、差错检测

**优点**

- 无需建立连接。UDP不会引入建立连接的时延。
- 无连接状态。不维护连接状态，不跟踪参数。一般能支持更多的活动客户机。
- 分组首部开销小。8B
- 应用层能更好地控制要发送的数据和发送时间。UDP没有拥塞控制，所以网络中的拥塞不会影响主机的发送效率。

应用：DNS、SNMP、多媒体应用。

尽最大努力交付。维护传输可靠性的工作需要用户在应用层来完成。

面向报文。应用层交付下来的报文，在添加首部后就向下交付给IP层，不合并也不拆分，保留这些报文的边界。

### 首部格式

UDP数据报分为：首部、用户数据。

首部8B，四部分

- 源端口号：在需要对方回信时选用，不需要时全0.
- 目的端口：终点交付报文时必须用到
- 长度：数据报的整个长度，最小8B（仅有首部
- 校验和：检测传输中是否有错。可选，源主机不想计算校验和时，该字段全为0｜若使用校验和且最后结果是全0，那检验和置为全1

【目的端口号不对，丢弃报文，并有 **ICMP** 发送“端口不可达”差错报文给发送方】

### 校验

在数据报之前添加12B的伪首部，得到新的临时UDP数据报

校验和根据新的UDP数据报计算。伪首部既不向下传送也不向上递交。

校验和既检查了UDP数据报，又对IP数据报的源IP地址和目的IP地址进行了检验。

**伪首部格式**

​		源IP地址（4）	目的IP地址（4）	全0（1）	17（协议字段 1）	UDP长度（2）

**方法**

二进制反码运算求和再取反

**发送方**首先把**全零放进校验和字段**并添加伪首部。然后把UDP数据报视为许多个16位的字连接起来。若数据部分不是偶数个字节，则需要补0。（此字节不发送）接下来**按二进制反码**计算出这些16位字的和。并将**此和的二进制反码**写入校验和字段。

**接收方**把收到的UDP数据报加上伪首部后，按二进制反码计算出这些16位的和。当无差错时结果全为1，否则表明出错，丢弃。（也可以交付上层，但需要附上错误报告）

## 5.3TCP

### 特点

- 面向连接、点对点连接
- 可靠的交付服务，保证传送的数据无差错、不丢失、不重复且有序
- 全双工通信，连接的两端都设有发送缓存和接收缓存。
  - 发送缓存：发送应用程序传送给发送方TCP准备发送的数据｜TCP已发送但尚未收到确认的数据
  - 接收缓存：按序到达但尚未被接收应用程序读取的数据｜不按序到达的数据
- 面向字节流

### 报文段

首部+数据【既可以用来运载数据，又可以用来建立连接、释放连接和应答】

首部最短20B，后面4N字节是根据需要而增加的选项。

![TCP](/Users/maydaylive/Desktop/复习专用存图/TCP.jpg)

- 源端口和目的端口：各2B，复用和分用通过端口实现

- 序号：4B。TCP面向字节流，所以每个数据流中的每个字节都编上一个序号。
  - 序号字段的值是指本报文段发送的数据的第一个字节的序号

- 确认号：4B。期望收到对方的下一个报文段的数据的第一个字节的序号

- 数据偏移：4位。即首部长度，指出TCP报文段的数据起始处距离TCP报文段的起始处有多远（值为15时，达到首部最大长度60B

- 保留：6位。目前设置为0，为今后所用
- URG紧急位：值为1，表明紧急指针字段有效。相当于高优先级的数据。
  - <u>配合紧急指针使用</u>//数据从第一个字节到紧急指针所指字节就是紧急数据
- ACK确认位：只有ACK=1时确认好字段才有效，连接建立时ACK=1
- PSH推送位：接收TCP收到PSH=1的报文段，就尽快地交付给接收应用进程，<u>而不再等到整个缓存都填满之后再向上交付</u>
- RST复位位：RST=1，表明TCP连接中出现严重差错，必须释放连接，然后再重新建立连接
- SYN同步位：SYN=1表明这是一个连接请求（SYN=1，ACK=0）或连接接收报文（SYN=1，ACK=1）
- FIN终止位：FIN=1表明此报文段的数据已发送完毕，并要求释放传输连接
- 窗口：2B。指出现在允许对方发送的数据量
- 校验和：2B。范围包括首部和数据两部分。校验之前在报文段前面加上12B的伪首部（把UDP协议字段改为6）
- 紧急指针：2B。指出本报文段中紧急数据共有多少字节（紧急数据放在本报文段数据的最前面）
- 选项字段：长度可变。TCP最初只规定了一种选项，最大报文段长度MSS。MSS是TCP报文段中的数据字段的最大长度
- 填充字段：使整个首部长度是4B的整数倍

### 连接管理

**解决问题**

1. 双方明确对方存在
2. 协商参数（最大窗口值、是否使用窗口扩大选项、时间戳选择及服务质量）
3. 对运输实体资源（缓存大小、连接表中的数目）进行分配

【TCP连接的端口称为套接字Socket】

#### 三次握手

1. SYN=1，seq=x
2. SYN=1，ACK，seq=y，ack=x+1
3. ACK=1，seq=x+1，ack=y+1（不携带数据则不消耗序号）

为什么是三次握手？



#### 四次挥手

1. FIN=1，seq=u（不携带数据也消耗一个序号
2. ACK=1，seq=v，ack=u+1（TCP半关闭
3. FIN=1，ACK=1，seq=w，ack=u+1
4. ACK=1，seq=u+1，ack=w+1（TCP连接还没有释放，必须等到时间等待计时器设置的时间2MSL后，才进入关闭状态

为什么是四次挥手？



### 可靠传输

**序号**

序号建立在传送的字节流之上，而不是报文段之上。

数据流中的每个字节都编上一个序号，序号字段的值是本报文段所发送的数据的第一个字节的序号。

**确认**

期待收到对方的下一个报文段的数据的第一个字节的序号。

*累计确认* 只确认数据流中至第一个丢失字节为止的字节

**重传**

原因：超时、冗余ACK

- 超时。每发送一个报文段，就对其设置一次计时器。
  - 自适应算法，记录一个报文段发出的时间，以及收到相应确认的时间。时间之差称为往返时间RTT
    - 新RTT<sub>s</sub>=(1-a) * (旧RTT<sub>s</sub>)+a * (新RTT样本)

- 冗余ACK。再次确认某个报文段的ACK，而发送发先前已经收到该报文段的确认
  - 每当比期望序号大的失序报文到达时，就发送一个冗余ACK，指明下一个期待的报文
    - 1，3，4，5到达。2丢失，接收方发送3个对1号报文段的冗余ACK，表明自己期待收到2号报文段。
    - TCP规定当发送方收到对同一个报文段的3个冗余ACK时，就可以认为跟在这个被确认报文段之后的报文已经丢失。
    - 发送方立刻发送2号报文。【快速重传】

### 流量控制

消除发送方使接收方缓存区溢出的可能

【基于滑动窗口】

接收方根据自己接收缓存的大小，动态地调整发送方的发送窗口的大小。**接收窗口rwnd**

发送方根据当前网络拥塞情况确定窗口值。**拥塞窗口cwnd**//与时延密切相关

【端到端用户之间】

### 拥塞控制

【让网络能够承受当前的网络负载，属于全局性的过程】

发送窗口的上限值 = min[rwnd,cwnd]

#### 慢开始

最开始cwnd=1（MSS），每收到一个确认，增加一个MSS。

cwnd大小指数式增长。直到cwnd增大到一个规定的慢开始门限ssthresh（阈值），然后改用拥塞避免算法。

#### 拥塞避免

cwnd按线性规律增大（加法增大），出现超时，令慢开始门限ssthresh等于当前cwnd的一半（乘法减小）

网络拥塞处理：无论哪个阶段，只要检测到超时事件，就把慢开始门限ssthresh设置为出现拥塞时的发送方cwnd一半（但不小于2）。

然后把拥塞窗口cwnd重新设置为1，执行慢开始算法。

【如果2cwnd>ssthresh，则下一个RTT的cwnd等于ssthresh】

#### 快重传

冗余ACK

#### 快恢复

收到冗余ACK之后，执行乘法减小，把门限设置为拥塞时的一半。之后执行拥塞避免算法。

# 应用层

## 6.1模型

### 客户/服务器模型

服务器：总是打开的主机｜收到请求之后，分析请求，处理响应，结果返回给客户机

客户机：必须知道服务器程序的地址。

**特点**

计算机地位不平等，服务器可以通过对用户权限的限制来达到管理客户机的目的。整个网络的管理工作由少数服务器担当。

客户机之间不相互直接通信。

可扩展性不佳。

### P2P模型

整个网络的传输内容不再必须保存在中心服务器上，每个节点都同时具有下载、上传的功能。

本质上是C/S模型，所有主机都可以是客户机/服务器。

**特点**

减少了服务器的计算压力，消除了对某个服务器的完全依赖，提高系统的效率和资源利用率

多个客户机之间直接共享文档

可扩展性好

网络健壮性强，不会因为一个节点的实效而整个网络受影响。

**缺点**：占用较多的内存，网络容易变得拥塞

## 6.2DNS域名系统

Domain Name System因特网使用的命名系统。

把便于人们记忆的具有特殊含义的<u>主机名</u>转换为便于机器处理的<u>IP地址</u>

【C/S模型】【UDP 53】

【如果一台主机通过两块网卡连接到两个网络，那么就具有两个IP地址， 每个网卡对应一个MAC地址，显然这两个IP地址可以映射到同一个域名上】

### 层次域名空间

层次树桩结构	三级域名.二级域名.顶级域名

**Attention**

1. 英文不区分大小写
2. 除了连字符（-）之外不能使用其他标点符号
3. 每个标号不超过63个字符，多标号组成的完整域名最长不超过255个字符
4. 级别最低的域名写在最左边，级别最高的写在最右边

**顶级域名TLD**

1. 国家顶级域名nTLD .cn .us
2. 通用顶级域名gTLD  .com .net .org .gov
3. 基础结构域名 只有一个 **arpa** 用于反向域名解析

### 域名服务器

联机分布式的数据库系统，采用客户/服务器模型

域名到IP地址的解析是由运行在域名服务器上的程序完成的

- 根域名服务器｜最高层次的域名服务器
  - 本地域名服务器无法解析的地址首先求助根域名服务器
  - 因特网上有1⃣️3⃣️个根域名服务器。属于冗余服务器集群
- 顶级域名服务器
- 授权域名服务器（权限域名服务器）
  - 每台主机都必须在授权域名服务器处登记。
  - 许多本地域名服务器都同时充当本地域名服务器和授权域名服务器
  - 总能将其管辖的主机名转换为该主机的IP地址
- 本地域名服务器
  - 一台主机发出DNS查询请求时，这个查询请求报文就发送到该主机的本地域名服务器
  - Windows配置本地连接时，就需要填写DNS地址

### 域名解析过程

正向解析：域名映射为IP地址

反向解析：IP地址映射为域名

客户端需要域名解析时，通过本机的DNS客户端构造一个DNS请求报文，以UDP数据报方式发往本地域名服务器。

分类：递归查询｜递归和迭代相结合

**主机向本地域名服务器的查询采用 <u>递归查询</u>**

本地域名服务器只需要向根域名服务器查询一次

**本地域名服务器向根域名服务器的查询采用 <u>迭代查询</u>**

根域名服务器

​	给出所要查询的IP地址

​	高速本地域名服务器：你下一步应当向哪个顶级域名服务器进行查询

广泛应用高速缓存

## 6.3FTP文件传输协议

提供交互式的访问，允许客户指明文件的类型与格式，并允许文件具有存取权限。

**功能**

- 提供不同种类主机系统之间的文件传输能力
- 以用户权限管理的方式提供用户对远程FTP服务器上的文件管理能力
- 以匿名FTP的方式提供公用文件共享的能力

【C/S模型】【TCP 21】

工作时使用两个并行的TCP连接：控制连接21｜数据连接20

**控制连接**

服务器监听21号端口。控制连接用来传输控制信息，并且控制信息都以7位ASCII格式传送。

控制连接整个会话期间一直保持打开状态

**数据连接**

传送完毕后关闭数据传送链接并结束运行

------

FTP使用分离的控制连接，所以也称FTP的控制信息是带外out-of-band传送的。使用FTP时，若要修改服务器上的文件，则需要先将此文件传送到本地主机，然后再将修改后的文件副本传送到原服务器。

## 6.4电子邮件

异步通信

- 用户代理：用户与电子邮件系统的接口。具有撰写、显示、邮件处理的功能 outlook foxmail thunderbird
- 邮件服务器：组成电子邮件系统的核心。发送和接收邮件，同时向发信人报告邮件传送的情况 C/S模型，同时充当C/S
- 邮件发送协议和读取协议：SMTP推｜POP3拉

**电子邮件格式** 首部+主体

**多用途国际邮件扩充MIME**：SMTP只能传送一定长度的ASCII码 所以提出了MIME

​	继续使用目前的格式，但增加了邮件主体的结构

### SMTP

Simple Mail Transfer Protocol简单邮件传输协议

提供可靠且有效的电子邮件传输协议 【C/S模型】【TCP 25】

- 连接建立：客户每隔一段时间对邮件缓存扫描一次，如果发现有邮件，用25号端口与接收方建立TCP连接
  - 连接建立之后，接收方SMTP服务器发出220 Service ready。然后SMTP客户向SMTP服务器发送HELO命令，附上发送方主机名
  - 不使用中间邮件服务器，两个服务器之间直接建立
- 邮件传送：MAIL命令开始，后面有发件人地址。
  - SMTP服务器准备好接收邮件，则回答250 OK。SMTP客户端发送一个or多个RCPT命令。每发送一个RCPT命令，都会收到返回消息，250 OK / 550 No such user here
    - RCPT命令作用：先弄清楚接收方系统是否已做好接收邮件的准备，然后才发送邮件。避免资源浪费
  - 收到OK命令，客户端使用DATA命令，表示要开始传输邮件的内容。
- 连接释放：客户发送QUIT命令，服务器返回221（服务关闭）邮件传输的全部过程结束。

### POP3

Post Office Protocol

【C/S模式】【TCP 110】

工作方式：下载并保存｜下载并删除

IMAP网际报文存取协议，建议标准

【用户浏览器与Hotmail或Gmail的邮件服务器之间的邮件发送或接收使用的是HTTP，只有在不同邮件服务器之间传送邮件才使用SMTP】

## 6.5WWW万维网

World Wide Web是一个资料空间。

资源：有用的事物，并由全域“统一资源定位符URL”标识

资源总过超文本传输协议HTTP传送给使用者，使用者通过单击链接来获取资源

万维网的内核部分是由三个标准构成的：

- 统一资源定位符URL。负责标识万维网上的各种文档，并使每个文档在整个万维网的范围内具有唯一的标识符
- 超文本传输协议HTTP：一个应用层协议，它使用TCP连接进行可靠的传输，HTTP是万维网客户程序和服务器程序之间交互所必须严格遵守的协议
- 超文本标记协议HTML：一种文档结构的标记语言，使用一些约定的标记对页面上的各种信息、格式进行描述

URL一般格式<协议>://<主机>:<端口>/<路径>【不区分大小写】

客户/服务器模式，浏览器是用户计算机上的www客户程序，万维网文档所驻留的计算机则运行服务器程序，这台计算机称为万维网服务器

### HTTP超文本传输协议

HyperText Transfer Protocol

【Transaction-oriented面相事物】

**操作**

首先要完成对WWW服务器的域名解析。一旦获得IP地址，就通过TCP向服务器发起连接建立请求。

服务器进程：每个万维网站点都有，不断地监听TCP的端口80，监听到连接后便建立连接。

报文类型：HTTP请求报文｜HTTP响应报文

用户鼠标单击后的事件

1. 浏览器分析链接指向页面的URL
2. 浏览器向DNS请求解析IP地址
3. 域名系统DNS解析出服务器的IP地址
4. 浏览器与服务器建立TCP连接
5. 浏览器发出HTTP请求
6. 服务器通过HTTP响应把文件发送给浏览器
7. TCP连接释放
8. 浏览器解析文件，并将Web页面显示给用户

**特点**

无状态

使用Cookie加数据库的方式来跟踪用户的活动。Cookie是存储在用户主机中的文本文件。内含一串“识别码”用于Web服务识别用户。

HTTP本身是无连接的。

HTTP既可以使用非持久连接，也可以使用持久连接

非持久连接：每个网页元素对象的传输都需要单独建立一次TCP连接

持久连接：服务器在发送响应后仍然保持这条连接

​	持久链接又分为非流水线｜流水线两种。

​	非流水线：客户收到前一个响应后才能发出下一个请求（HTTP/1.1默认）。这种情况下，客户每遇到一个对象引用就立即发出一个请求，因而客户可以逐个连续发出对各个引用对象的请求。

**报文结构**

HTTP是Text-Oriented，所以报文中的每个字段都是一些ASCII码串，并且每个字段的长度都是不确定的。

![HTTP](/Users/maydaylive/Desktop/复习专用存图/HTTP.png)

开始行不同。

开始行：用于区分是请求报文还是响应报文

请求报文的请求行有三个内容：方法、请求资源的URL、HTTP的版本

​	方法：对所有请求对象进行的操作

|   GET   |    请求读取由URL标识的信息    |
| :-----: | :---------------------------: |
|  HEAD   | 请求读取由URL标识的信息的首部 |
|  POST   |  给服务器添加信息（如注释）   |
| CONNECT |        用于代理服务器         |

------

| 应用程序 | FTP数据连接 | FTP控制连接 | TENLET | SMTP | DNS  | TFTP | HTTP | POP3 | SNMP |
| :------: | :---------: | :---------: | :----: | :--: | :--: | :--: | :--: | :--: | :--: |
| 使用协议 |     TCP     |     TCP     |  TCP   | TCP  | UDP  | UDP  | TCP  | TCP  | UDP  |
|  端口号  |     20      |     21      |   23   |  25  |  53  |  69  |  80  | 110  | 161  |

